<!DOCTYPE html>

<html>

  <head>
    <!-- Encoding -->
    <meta charset="UTF-8">
    <!-- Description of Web Page -->
    <meta name="description" content="GIS Project">
    <!-- Keywords important for Google -->
    <meta name="keywords" content="Raphael Witt, Zhendong Yuan, Geoinformatics, Students">
    <!-- Author -->
    <meta name="author" content="Raphael Witt, Zhendong Yuan, Mohammad Robiul Hussain">
    <!-- Title -->
    <title>Unemployment Data Visualisation - GI in Society</title>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <!-- Style -->
    <style>
  	div#mapid {
	  height: 450px;
      border-radius: 20px;
      border-style: solid;
      border-color: gray;
      border-width: 1px;
  	}
    div#displaybox {
      border-radius: 20px;
      border-style: solid;
      border-color: gray;
      border-width: 1px;
      margin-left: 30px;
      margin-right: 10px;
    }
    div#displayfunctions {
      border-radius: 20px;
      border-style: solid;
      border-color: gray;
      border-width: 1px;
      margin-left: 10px;
      margin-right: 30px;
    }
    .container-fluid {
      margin-top: 25px;
      margin-bottom: 10px;
    }
    hr {
		display: block;
		margin-left: auto;
		margin-right: auto;
		border-style: solid;
		border-width: 1px;
    }
    .centered{
    float: none;
    margin: 0 auto;
    }
	#test {
	}
	#te {
	text-align: center;
  margin-top: 5px;
	}
    .pull-right {
      float: bottom !important;
    }
	.slidecontainer {
		width: 100%;
	}
	.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 5px;
    border-radius: 5px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
	}
  #chartContainer {
    margin-top: 35px;
    margin-bottom: 5px;
    height: 50%;
  }
  .head {
    position: absolute;
    left: 87%;
    top: 3%;
  }
  #getStateName {
    font-size: 20px;
    margin-top: 5px;
  }
  h2 {
    text-align: center;
    margin-top: 10px;
  }

  </style>
  </head>

  <body>
    <h2>Unemployment in federal states of Germany</h2>
    <div class="head">
        <a target="_blank" href="info.html">
          <img src="img/Hilfe.jpg" class="img-responsive" width="13%"/>
      Help
        </a>
        <a target="_blank" href="contact.html">
          <img src="img/Kontakt_weiß.jpg" class="img-responsive" width="13%"/>
      Contact
        </a>

    </div>


    <hr></hr>
    <div class="container-fluid">
      <div class="row">
      <div class="col" id="displayfunctions">
        <h5>Legend</h5>
        <img src="img/legendplaceholder.jpg" width="70%"/>
          <br>
          <br>
          <br>
          <h5>Select Parameter</h5>
          <form>
		  		<select name="parameter" id="parameter" >
                <option value="numofindustries">Number of Industries</option>
                <option value="popdens">Population density</option>
				<option value="gdp">GDP per Capita</option>
				<option value="riskofpoverty">Risk of Poverty</option>
        </select><br>
		<br>
		<p>When a parameter is selected, please click on the federal state you want to retrieve the information from.</p>
    <br>
		<div class="slidecontainer">
		  <input type="range" min="2008" max="2015" value="2010" class="slider" id="sliderRange">
		</div>
		<div id="te">
		  <font size="4" id="year">2010</font>
	    </div>

<!--             <div class="radio">
              <label><input type="radio" value="numofindustries" name="optradio" checked>Number of industries</label>
            </div>
            <div class="radio"> domain/range	rdf data cube vocabulary
              <label><input type="radio" value="popdens" name="optradio">Population density</label>
            </div>
            <div class="radio">
              <label><input type="radio" value="gdp" name="optradio">GDP</label>
            </div>
            <div class="radio">
              <label><input type="radio" value="riskofpoverty" name="optradio">Risk of poverty</label>
            </div> -->
          </form>
      </div>

      <div class="col-6" id="mapid"></div>

      <div class="col" id="displaybox">
        <h5 id="getStateName">Selected federal state: </h5>
        <!-- <p id="getStateName"></p> -->
        <p id="chartContainer"></p>
      </div>
    </div>
    </div>

    <!-- <div class="container-fluid" id="test">
      <div class="row">
      <div class="col-4">
          <a target="_blank" href="info.html">
            <img src="img/Hilfe.jpg" class="img-responsive" width="12%"/>
  		  Help
          </a>
          <a target="_blank" href="contact.html">
            <img src="img/Kontakt_weiß.jpg" class="img-responsive" width="12%"/>
  		  Contact
          </a>

      </div> -->
<!-- 	  	<div class="col-8">
			<div class="slidecontainer">
				<input type="range" min="2005" max="2015" value="2010" class="slider" id="sliderRange">
			</div>
			<div id="te">
				<font size="4" id="year">2010</font>
			</div>
		</div> -->
    <!-- </div>
    </div> -->
    <!-- <button id="button">Klick</button>
    <p id="testtest">Test</p>
    <br>
    <button id="button2">Klick</button>
    <p id="testtest2">Test</p> -->

    <script type="text/javascript" src="./js/statesJSON.js"></script>

    <script>
    var slider = document.getElementById("sliderRange");
	var output = document.getElementById("year");
	output.innerHTML = slider.value;

	slider.oninput = function() {
	  output.innerHTML = this.value;
    //getData();
	}



	 //Creating map
    var mymap = L.map('mapid', {zoomControl:true, maxZoom: 12, minZoom: 5}).setView([51.5167, 9.9167], 5);
    mymap.zoomControl.setPosition('bottomleft');

    mymap.setMaxBounds([
      [40,-5],
      [60,25]
    ]);

    var legend = L.control({position: 'bottomright'});

    legend.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend'),
            grades = ["50.000", "100.000", "150.000", "200.000","250.000"],
            labels = [];

        // loop through our density intervals and generate a label with a colored square for each interval
        for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
                grades[i]  +'<br>';
        }

        return div;
    };

    legend.addTo(mymap);

    var stateName;

    //Adding a tile layer from OSM
      L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 14,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>, Contributor of state data: <a href="https://github.com/isellsoap">Francesco Schwarz</a>',
      }).addTo(mymap);

      function style(feature) {
      return {
        weight: 2,
        opacity: 1,
        color: 'blue',
        dashArray: '2',
        fillOpacity: 0.0,
        };
      }

      function highlightFeature(e) {
        var layer = e.target;
        layer.setStyle({
            weight: 5,
            color: '#222',
            dashArray: '2',
            fillOpacity: 0.7
        });
      }

      function resetHighlight(e) {
        geojson.resetStyle(e.target);
      }


      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: function(e){
            mymap.fitBounds(e.target.getBounds());
            stateName = feature.properties.NAME_1;
            document.getElementById("getStateName").innerHTML = "Selected federal state:" + "<br/>" + stateName;
            createDaDa();
          }
        });
      }

      var geojson;
      geojson = L.geoJson(statesData, {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(mymap);

      function getGDP(){
        var qry = "select * from <http://course.geoinfo2017.org/GC> where { <http://example.org/data/GDP.csv#" + stateName + "> ?b ?c.}";// + slider.value  + " <http://example.org/data/GDP.csv#>
        $.post("http://giv-oct2.uni-muenster.de:8890/sparql", {
        query: qry,
        output: 'json'
        },
        function(data){
          // var gdp = parseFloat(data.results.bindings[0].c.value);
          // document.getElementById("getGDP").innerHTML = gdp;
          createGDPDiagram(data);
        });
      }

      function getROP(){
        var qry = "select * from <http://course.geoinfo2017.org/GC> where { <http://example.org/data/povertyRate.csv#" + stateName + "> ?b ?c.}";// + slider.value  + " <http://example.org/data/GDP.csv#>
        $.post("http://giv-oct2.uni-muenster.de:8890/sparql", {
        query: qry,
        output: 'json'
        },
        function(data){
          // var gdp = parseFloat(data.results.bindings[0].c.value);
          // document.getElementById("getGDP").innerHTML = gdp;
          createROPDiagram(data);
        });
      }

      function getPopdens(){
        var qry = "select * from <http://course.geoinfo2017.org/GC> where { <http://example.org/data/populationDensity.csv#" + stateName + "> ?b ?c.}";
        $.post("http://giv-oct2.uni-muenster.de:8890/sparql", {
        query: qry,
        output: 'json'
        },
        function(data){
          // var popdens = parseFloat(data.results.bindings[0].c.value);
          // document.getElementById("getPopulationDensity").innerHTML = popdens;
          createPDDiagram(data);
        });
      }

      function getNumberOfIndustries(){
        var qry = "select * from <http://course.geoinfo2017.org/GC> where { <http://example.org/data/NumberOfIndustries.csv#" + stateName + "> ?b ?c.}";
        $.post("http://giv-oct2.uni-muenster.de:8890/sparql", {
        query: qry,
        output: 'json'
        },
        function(data){
          createNUIDiagram(data);
        });
      }

      function getUnemplyoment(){
        var qry = "select * from <http://course.geoinfo2017.org/GC> where { <http://example.org/data/unemploymentRate#" + stateName + "> ?b ?c.}";
        $.post("http://giv-oct2.uni-muenster.de:8890/sparql", {
        query: qry,
        output: 'json'
        },
        function(data){
          return data;
        });
      }
      //   var xmlhttp = new XMLHttpRequest();
      //   var url = "http://giv-oct2.uni-muenster.de:8890/sparql?default-graph-uri=http%3A%2F%2Fcourse.geoinfo2017.org%2FGC&query=select+*%0D%0Afrom+%3Chttp%3A%2F%2Fcourse.geoinfo2017.org%2FGC%3E%0D%0Awhere%0D%0A%7B%0D%0A+%3Chttp%3A%2F%2Fexample.org%2Fdata%2FunemploymentRate%23Baden-W%C3%BCrttemberg%3E%0D%0A+%3Fb%0D%0A+%3Fc.%0D%0A+%7D&format=json&timeout=0&debug=on";
      //   xmlhttp.onreadystatechange = function(){
      //       if(xmlhttp.readyState == 4  && xmlhttp.status == 200){
      //         document.getElementById("testtest").innerHTML = xmlhttp.responseText;
      //       }
      //   }
      //   xmlhttp.open("POST", url, true)
      //   xmlhttp.send()
      //   console.log("Erfolgreich")
      // }


      function minmax(data) {
          var min = parseFloat(data.results.bindings[0].c.value);
          var max = parseFloat(data.results.bindings[0].c.value);
          for(var i in data.results.bindings) {
              if(parseFloat(data.results.bindings[i].c.value) < min) {
                  min = parseFloat(data.results.bindings[i].c.value);
              }
              if(parseFloat(data.results.bindings[i].c.value) > max) {
                  max = parseFloat(data.results.bindings[i].c.value);
              }
          }
          return [min, max];
      }

      function createDaDa(){
        if(document.getElementById("parameter").value == "gdp"){
          getGDP();
        }
        if(document.getElementById("parameter").value == "popdens"){
          getPopdens();
        }
        if(document.getElementById("parameter").value == "numofindustries"){
          getNumberOfIndustries();
        }
        if(document.getElementById("parameter").value == "riskofpoverty"){
          getROP();
        }
      }

      function createGDPDiagram(data){
        var gdpdata = [];
        var gdpyear = [];
        for(var i in data.results.bindings) {
                gdpdata[i] = parseFloat(data.results.bindings[i].c.value);
                //gdpyear[i] = parseInt(data.results.bindings[i].b.value);
                console.log(gdpdata[i]);
                //console.log(gdpyear[i]);
            }


      var chart = new CanvasJS.Chart("chartContainer", {
  	animationEnabled: true,
  	theme: "light1", // "light1", "light2", "dark1", "dark2"
  	title:{
  		text: "GDP per Capita",
      fontFamily: "tahoma",
  	},
  	axisY: {
  		title: "GDP in €"
  	},
  	data: [{
  		type: "column",
  		showInLegend: false,
      color: "blue",
  		// legendMarkerColor: "grey",
  		// legendText: "MMbbl = one million barrels",
  		dataPoints: [
        { y: gdpdata[17], label: "2008" },
        { y: gdpdata[18],  label: "2009" },
        { y: gdpdata[19],  label: "2010" },
        { y: gdpdata[20],  label: "2011" },
        { y: gdpdata[21],  label: "2012" },
        { y: gdpdata[22], label: "2013" },
        { y: gdpdata[23],  label: "2014" },
        { y: gdpdata[24],  label: "2015" }
  		]
  	}]
  });
  chart.render();
}

function createNUIDiagram(data){
  var noidata = [];
  var gdpyear = [];
  for(var i in data.results.bindings) {
          noidata[i] = parseInt(data.results.bindings[i].c.value);
          //gdpyear[i] = parseInt(data.results.bindings[i].b.value);
          console.log(noidata[i]);
          //console.log(gdpyear[i]);
      }


var chart = new CanvasJS.Chart("chartContainer", {
animationEnabled: true,
theme: "light1", // "light1", "light2", "dark1", "dark2"
title:{
text: "Number of Industries",
fontFamily: "tahoma",
},
axisY: {
title: "Number of Industries"
},
data: [{
type: "column",
color: "black",
showInLegend: false,
// legendMarkerColor: "grey",
// legendText: "MMbbl = one million barrels",
dataPoints: [
  { y: noidata[0], label: "2008" },
  { y: noidata[1],  label: "2009" },
  { y: noidata[2],  label: "2010" },
  { y: noidata[3],  label: "2011" },
  { y: noidata[4],  label: "2012" },
  { y: noidata[5], label: "2013" },
  { y: noidata[6],  label: "2014" },
  { y: noidata[7],  label: "2015" },
]
}]
});
chart.render();
}

function createROPDiagram(data){
  var ropdata = [];
  var gdpyear = [];
  for(var i in data.results.bindings) {
          ropdata[i] = parseFloat(data.results.bindings[i].c.value);
          //gdpyear[i] = parseInt(data.results.bindings[i].b.value);
          console.log(ropdata[i]);
          //console.log(gdpyear[i]);
      }


var chart = new CanvasJS.Chart("chartContainer", {
animationEnabled: true,
theme: "light1", // "light1", "light2", "dark1", "dark2"
title:{
text: "Risk of Poverty",
fontFamily: "tahoma",
},
axisY: {
title: "Poverty rate in %"
},
data: [{
type: "column",
color: "darkred",
showInLegend: false,
// legendMarkerColor: "grey",
// legendText: "MMbbl = one million barrels",
dataPoints: [
  { y: ropdata[3], label: "2008" },
  { y: ropdata[4],  label: "2009" },
  { y: ropdata[5],  label: "2010" },
  { y: ropdata[6],  label: "2011" },
  { y: ropdata[7],  label: "2012" },
  { y: ropdata[8], label: "2013" },
  { y: ropdata[9],  label: "2014" },
  { y: ropdata[10],  label: "2015" },
]
}]
});
chart.render();
}

function createPDDiagram(data){
  var pddata = [];
  var gdpyear = [];
  for(var i in data.results.bindings) {
          pddata[i] = parseFloat(data.results.bindings[i].c.value);
          //gdpyear[i] = parseInt(data.results.bindings[i].b.value);
          console.log(pddata[i]);
          //console.log(gdpyear[i]);
      }


var chart = new CanvasJS.Chart("chartContainer", {
animationEnabled: true,
theme: "light1", // "light1", "light2", "dark1", "dark2"
title:{
text: "Population density",
fontFamily: "tahoma",
},
axisY: {
title: "Population density per km²",
// interval: 50
},
data: [{
type: "column",
color: "gray",
showInLegend: false,
// legendMarkerColor: "grey",
// legendText: "MMbbl = one million barrels",
dataPoints: [
  { y: pddata[14], label: "2008" },
  { y: pddata[0],  label: "2009" },
  { y: pddata[15],  label: "2010" },
  { y: pddata[16],  label: "2011" },
  { y: pddata[17],  label: "2012" },
  { y: pddata[18], label: "2013" },
  { y: pddata[19],  label: "2014" },
  { y: pddata[20],  label: "2015" }
]
}]
});
chart.render();
}






      //document.getElementById("button").onclick = function() {getData()};
      // document.getElementById("button2").onclick = function() {minmax(data)};

    </script>

    </body>

</html>
